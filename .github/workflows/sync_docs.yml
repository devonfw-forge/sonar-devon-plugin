name: sonarcloud
env:
  ORG: "comdevonfw"
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  BUILD_USER: ${{ secrets.BUILD_USER }}
  BUILD_USER_PASSWD: ${{ secrets.BUILD_USER_PASSWD }}
  BUILD_USER_EMAIL: ${{ secrets.BUILD_USER_EMAIL }}
on:
  push:
    branches:  master
    
jobs:
    build:
        if: ${{github.repository == 'devonfw/sonar-devon4j-plugin'}}
        runs-on: ubuntu-latest
        steps:
           - name: Set up JDK
             uses: actions/setup-java@v1
             with:
              java-version: '8'
           - name: build the project with Maven     
             run:
               mvn clean -Pjacoco-report install sonar:sonar -Dsonar.projectKey=devonfw_sonar-devon4j-plugin -Dsonar.host.url=https://sonarcloud.io -Dsonar.organization=comdevonfw;
           - name: Setup tmate session
             uses: mxschmitt/action-tmate@v3
             with:
              sudo: false
           - name: Cache Maven packages
             uses: actions/cache@v2
             with:
                path: ~/.m2
                key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
                restore-keys: ${{ runner.os }}-m2-
           - name: Notification mail
             if: always()
             uses: dawidd6/action-send-mail@v2
             with:
               server_address: smtp.gmail.com
               server_port: 465               
               username: ${{ secrets.BUILD_USER }}
               password: ${{ secrets.BUILD_USER_PASSWD }}            
               subject: ${{ github.job }} job of ${{ github.repository }} has ${{ job.status }}            
               body: ${{ github.job }} job in worflow ${{ github.workflow }} of ${{ github.repository }} has ${{ job.status }}
               to: joerg.hohwiller@gmail.com
               from: Hohwiller Jorg    
